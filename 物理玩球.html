<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Matter.js ç‰©ç†å¼•æ“æ¼”ç¤º</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial;
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        .animal-name {
            position: absolute;
            color: white;
            font-family: Arial;
            font-size: 14px;
            pointer-events: none;
            text-shadow: 1px 1px 2px black;
            animation: fadeOut 1s forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="info">ç‰©é«”æ•¸é‡: 0 | FPS: 0</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script>
        const Engine = Matter.Engine,
            Render = Matter.Render,
            Runner = Matter.Runner,
            Bodies = Matter.Bodies,
            Composite = Matter.Composite,
            Mouse = Matter.Mouse,
            MouseConstraint = Matter.MouseConstraint,
            Constraint = Matter.Constraint,
            Events = Matter.Events;

        // å‰µå»ºå¼•æ“
        const engine = Engine.create();
        const world = engine.world;

        // å‰µå»ºæ¸²æŸ“å™¨
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: {
                width: window.innerWidth,
                height: window.innerHeight,
                wireframes: false,
                background: '#f0f0f0'
            }
        });

        // å•Ÿå‹•æ¸²æŸ“å™¨
        Render.run(render);
        const runner = Runner.create();
        Runner.run(runner, engine);

        // å‰µå»ºé‚Šç•Œ
        const walls = [
            Bodies.rectangle(window.innerWidth/2, 0, window.innerWidth, 60, { isStatic: true }),
            Bodies.rectangle(window.innerWidth/2, window.innerHeight, window.innerWidth, 60, { isStatic: true }),
            Bodies.rectangle(0, window.innerHeight/2, 60, window.innerHeight, { isStatic: true }),
            Bodies.rectangle(window.innerWidth, window.innerHeight/2, 60, window.innerHeight, { isStatic: true })
        ];
        Composite.add(world, walls);

        // è®Šé‡åˆå§‹åŒ–
        let bodies = [];
        let lastTime = performance.now();
        let frames = 0;
        let fps = 0;

        // å‰µå»ºæ»‘é¼ æ§åˆ¶
        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                stiffness: 0.2,
                damping: 0.1,
                render: {
                    visible: false
                }
            }
        });

        // æ·»åŠ æ»‘é¼ æ§åˆ¶åˆ°ä¸–ç•Œ
        Composite.add(world, mouseConstraint);
        render.mouse = mouse;

        // æ·»åŠ æ»‘é¼ ç‹€æ…‹è¿½è¸ª
        let isMouseDown = false;
        let lastMouseSpawnTime = 0;
        const mouseSpawnInterval = 50;

        // ä¿®æ”¹æ»‘é¼ äº‹ä»¶ç›£è½
        Events.on(mouseConstraint, 'mousedown', function(event) {
            isMouseDown = true;
            if (mouseConstraint.body === null) {
                const mousePosition = event.mouse.position;
                createRandomBody(mousePosition.x, mousePosition.y);
                lastMouseSpawnTime = performance.now();
            }
        });

        Events.on(mouseConstraint, 'mousemove', function(event) {
            if (isMouseDown && mouseConstraint.body === null) {
                const currentTime = performance.now();
                if (currentTime - lastMouseSpawnTime >= mouseSpawnInterval) {
                    const mousePosition = event.mouse.position;
                    createRandomBody(mousePosition.x, mousePosition.y);
                    lastMouseSpawnTime = currentTime;
                }
            }
        });

        Events.on(mouseConstraint, 'mouseup', function() {
            isMouseDown = false;
        });

        // æ·»åŠ  emoji è½‰æ›å‡½æ•¸
        function emojiToDataURL(emoji, size) {
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            ctx.font = `${size}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(emoji, size/2, size/2);
            return canvas.toDataURL();
        }

        // ä¿®æ”¹å‰µå»ºç‰©é«”å‡½æ•¸
        function createRandomBody(x, y) {
            const size = Math.random() * 30 + 20;
            const emojis = [
                { name: "å°ç‹—", emoji: "ğŸ•" },
                { name: "å…”å­", emoji: "ğŸ°" },
                { name: "è²“å’ª", emoji: "ğŸ±" },
                { name: "å°é³¥", emoji: "ğŸ¦" },
                { name: "é­šå…’", emoji: "ğŸ " },
                { name: "å°è±¬", emoji: "ğŸ·" },
                { name: "ç†Šè²“", emoji: "ğŸ¼" },
                { name: "ç…å­", emoji: "ğŸ¦" },
                { name: "è€è™", emoji: "ğŸ¯" },
                { name: "çŒ´å­", emoji: "ğŸµ" }
            ];

            const animal = emojis[Math.floor(Math.random() * emojis.length)];
            const dataURL = emojiToDataURL(animal.emoji, size);
            
            const body = Bodies.circle(x, y, size/2, {
                render: {
                    sprite: {
                        texture: dataURL,
                        xScale: 1,
                        yScale: 1
                    }
                }
            });
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'animal-name';
            nameDiv.style.left = `${x}px`;
            nameDiv.style.top = `${y}px`;
            nameDiv.textContent = animal.name;
            document.body.appendChild(nameDiv);
            
            setTimeout(() => {
                nameDiv.remove();
            }, 1000);

            bodies.push(body);
            Composite.add(world, body);
        }

        // ä¿®æ”¹ç©ºç™½éµäº‹ä»¶
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (e.shiftKey) {
                    // Shift + ç©ºç™½éµï¼šæ¸…é™¤æ‰€æœ‰ç‰©é«”
                    bodies.forEach(body => Composite.remove(world, body));
                    bodies = [];
                } else {
                    // ç©ºç™½éµï¼šéš¨æ©Ÿç”Ÿæˆ10å€‹ç‰©é«”
                    for (let i = 0; i < 10; i++) {
                        const x = Math.random() * (window.innerWidth - 100) + 50;
                        const y = Math.random() * (window.innerHeight - 100) + 50;
                        createRandomBody(x, y);
                    }
                }
            }
        });

        // æ›´æ–°ä¿¡æ¯é¡¯ç¤º
        function updateInfo() {
            frames++;
            const now = performance.now();
            if (now - lastTime >= 1000) {
                fps = frames;
                frames = 0;
                lastTime = now;
            }
            document.getElementById('info').textContent = 
                `ç‰©é«”æ•¸é‡: ${bodies.length} | FPS: ${fps}`;
            requestAnimationFrame(updateInfo);
        }

        updateInfo();
    </script>
</body>
</html>
